function initMarquee(){$(".marquee").marquee({duration:15e3,gap:50,delayBeforeStart:0,direction:"left",duplicated:!0})}function isExceedTag(){var t=!1;return $(".musicTag strong").width()+$(".musicTag span").width()+$(".musicTag .artist").width()>$(".musicTag").width()&&(t=!0),t}function shuffle(t){for(var a,e,i=t.length;i;)e=Math.floor(Math.random()*i--),a=t[i],t[i]=t[e],t[e]=a;return t}function showNotification(t){isShowNotification=!0,$(".qplayer-notification").length>0&&($(".qplayer-notification").remove(),clearTimeout(autoClearTimer),clearTimeout(autoShowTimer)),$("body").append('<div class="qplayer-notification animation-target"><span class="qplayer-notification-icon">i</span><span class="body" style="box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 5px;"><span class="message"></span></span><a class="close" href="#" onclick="closeNotification();return false;">×</a><div style="clear: both"></div>'),$(".qplayer-notification .message").text(t);var a=$(".qplayer-notification").css({opacity:"0",width:"auto"}).width()+20;$(".qplayer-notification").css({width:"50px",opacity:"1"}),autoShowTimer=setTimeout((function(){$(".qplayer-notification").css({width:a,transition:"all .7s ease"}),$(".qplayer-notification .close").delay(500).show(0)}),1500),autoClearTimer=setTimeout("if ($('.qplayer-notification').length>0) {closeNotification()}",8e3)}function closeNotification(){isShowNotification=!1,$(".qplayer-notification").css({width:"50px",transition:"all .7s ease"}),$(".qplayer-notification .close").delay(500).hide(0),setTimeout((function(){isShowNotification||($(".qplayer-notification").css("opacity","0"),$(".qplayer-notification-icon").css({transform:"scale(0)",transition:"transform .5s ease"}))}),1e3),setTimeout((function(){isShowNotification||$(".qplayer-notification").remove()}),1500),clearTimeout(autoClearTimer),clearTimeout(autoShowTimer)}function showTips(t,a,e){$("body").append('<div class="qplayer_tips"><span class="tips_arrow"></span><span class="info" style="display:none">'+a+'</span><button class="tips_button" onclick="removeTips()">Continued</button></div>'),$(".qplayer_tips").css({top:$(t).offset().top-100-30-15,left:$(t).offset().left-28}),$(".qplayer_tips").css({height:100,transition:"all .5s ease-in-out"}),$(".qplayer_tips .info").delay(500).fadeIn(),$(".tips_arrow").css({"border-width":"15px",transition:"all .5s ease-in-out"}),$(".tips_button").css({height:"30px",transition:"all .5s ease-in-out"}),null!=e&&$(".tips_button").click(e)}function removeTips(){$(".qplayer_tips .info").fadeOut(),$(".qplayer_tips").css({height:"0",transition:"all .5s ease-in-out"}),$(".tips_arrow").css({"border-width":"0",transition:"all .5s ease-in-out"}),$(".tips_button").css({opacity:"0",transition:"all .2s ease-in-out"}),setTimeout((function(){$(".qplayer_tips").remove()}),500)}!function(t){for(var a,e=!0,i=[],n=null==localStorage.qplayer,s=null!=localStorage.qplayer&&"true"===localStorage.qplayer,o=0;o<playlist.length;o++){var l=playlist[o];t("#playlist").append('<li class="lib" style="overflow:hidden;"><strong style="margin-left: 5px;">'+l.title+'</strong><span style="float: right;" class="artist">'+l.artist+"</span></li>"),""==l.mp3&&t("#playlist li").eq(o).css("color","#ddd")}var r,c,p=0,u=localStorage.qplayer_shuffle_array;s&&null!=u&&playlist.length===(i=JSON.parse(u)).length?(p=i[0],a=0,t("#QPlayer .cover").attr("title","Nhấp để đóng xáo trộn")):(s=!1,t("#QPlayer .cover").attr("title","Nhấp để bắt đầu phát ngẫu nhiên"));var f=0;for(o=0;o<playlist.length;o++)f+=t("#playlist li").eq(o).height()+6;if(f>360&&(t("#playlist").css("overflow","auto"),s)){for(var h=0,y=0;y<p;y++)h+=t("#playlist li").eq(y).height()+6;t("#playlist").scrollTop(h)}var d,g,m=function(){r.play(),isRotate&&(t("#player .cover img").css("animation","9.8s linear 0s normal none infinite rotate"),t("#player .cover img").css("animation-play-state","running")),t(".playback").addClass("playing"),c=setInterval(T,500),isExceedTag()&&(e?(initMarquee(),e=!1):t(".marquee").marquee("resume"))},v=function(){r.pause(),t("#player .cover img").css("animation-play-state","paused"),t(".playback").removeClass("playing"),clearInterval(c),isExceedTag()&&t(".marquee").marquee("pause")},q=function(a){var e=parseInt(a%60)<10?"0"+parseInt(a%60):parseInt(a%60);r.duration;t(".timer").html(parseInt(a/60)+":"+e)},T=function(){q(r.currentTime)},b=function(a){a<0?track=p=playlist.length-1:a>=playlist.length?track=p=0:track=a,e=!0,t("audio").remove(),_(track),m()},w=function(t){1===t?(++a===i.length&&(a=0),p=i[a]):0===t&&(--a<0&&(a=i.length-1),p=i[a]),b(p)},$=function(){v(),r.currentTime=0,s?w(1):p<playlist.length&&b(++p)},x=function(){this.seekable&&this.seekable.length&&this.seekable.end(0)},k=function(){1==autoplay&&m()},_=function(e){for(var n=playlist[e];""==n.mp3;)showNotification("Địa chỉ bài hát trống, nó đã tự động bị bỏ qua"),s?(++a===i.length&&(a=0),e=p=i[a]):p=++e,n=playlist[e];var o=t("<audio>").html('<source src="'+n.mp3+'"><source src="'+n.ogg+'">').appendTo("#player");t(".cover").html('<img src="'+n.cover+'" alt="'+n.album+'">'),t(".musicTag").html("<strong>"+n.title+'</strong><span> - </span><span class="artist">'+n.artist+"</span>"),t("#playlist li").removeClass("playing").eq(e).addClass("playing"),(r=o[0]).addEventListener("progress",x,!1),r.addEventListener("durationchange",x,!1),r.addEventListener("canplay",k,!1),r.addEventListener("ended",$,!1)};_(p),t(".playback").on("click",(function(){t(this).hasClass("playing")?v():m()})),t(".rewind").on("click",(function(){s?w(0):b(--p)})),t(".fastforward").on("click",(function(){s?w(1):b(++p)})),t("#playlist li").each((function(e){t(this).on("click",(function(){if(s){for(var t=0;t<i.length;t++)if(i[t]===e){a=t;break}}else p=e;b(e)}))})),t("#QPlayer .liebiao,#QPlayer .liebiao").on("click",(function(){var a=t("#playlist");!1===a.hasClass("go")?(a.css({"max-height":"360px",transition:"max-height .5s ease"}),a.css("border","1px solid #dedede"),a.addClass("go")):(a.css({"max-height":"0px",transition:"max-height .5s ease"}),a.css("border","0"),a.removeClass("go"))})),t("#QPlayer").css("transform","translateX(250px)"),t(".ssBtn .adf").addClass("on"),t("#QPlayer .ssBtn").on("click",(function(){var a=t("#QPlayer");!1===t(".ssBtn .adf").hasClass("on")?(n&&(setTimeout("showTips('#player .cover','Bấm vào bìa để mở (đóng) chơi ngẫu nhiên', "+function(){setTimeout("showTips('#player .ctrl .musicTag','Nhấp và kéo thanh tiêu đề để tua nhanh (tua lại)')",1e3)}+");",500),n=!n,localStorage.qplayer="false"),a.css("transform","translateX(250px)"),t(".ssBtn .adf").addClass("on")):(a.css("transform","translateX(0px)"),t(".ssBtn .adf").removeClass("on"))})),t("#player .cover").on("click",(function(){if(s=!s){t("#player .cover").attr("title","Nhấp để đóng xáo trộn"),showNotification("Phát ngẫu nhiên đang bật");for(var e=[],n=0;n<playlist.length;n++)e[n]=n;i=shuffle(e);for(var o=0;o<i.length;o++)if(i[o]===p){a=o;break}localStorage.qplayer_shuffle_array=JSON.stringify(i)}else t("#player .cover").attr("title","Nhấp để bắt đầu phát ngẫu nhiên"),showNotification("Đã tắt phát ngẫu nhiên"),localStorage.removeItem("qplayer_shuffle_array");localStorage.qplayer=s})),t("#player .ctrl .musicTag").mousedown((function(t){d=t.screenX})).mousemove((function(t){if(1===t.which){g=t.screenX;var a=Math.round((g-d)/678*100);r.currentTime+=a,q(r.currentTime)}})),t("#player .ctrl .musicTag").bind("touchstart",(function(t){d=t.originalEvent.targetTouches[0].screenX})).bind("touchmove",(function(t){g=t.originalEvent.targetTouches[0].screenX;var a=Math.round((g-d)/678*100);r.currentTime+=a,q(r.currentTime)}))}(jQuery);